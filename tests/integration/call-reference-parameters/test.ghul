namespace Test is
    use System.String;
    use System.Console;

    use System.Threading.Monitor;
    use Collections.MAP;

    class Main is
        init() is
        si        

        entry() static is
            @IL.entrypoint()

            new Main().test();
        si
        
        test() is
            let map = new MAP[String,String]();

            map.add("A", "a");
            map.add("B", "b");
            map.add("C", "c");

            let result: String;

            for k in ["X", "A", "B", "C", "Y"] do
                let is_locked = false;
                try
                    Console.write_line("try enter monitor...");
                    Monitor.enter(self, is_locked ref);
                    Console.write_line("in monitor: locked is: " + is_locked);

                    if map.try_get_value(k, result ref) then
                        Console.write_line("got value '" + result + "' for key '" + k + "'");
                    else
                        Console.write_line("could not get value for key '" + k + "'");
                    fi   
                finally
                    Console.write_line("exit monitor...");
                    if is_locked then
                        Monitor.exit(self);                        
                    fi
                yrt
            od

            return;
        si        
    si
si