/*

https://github.com/degory/ghul/issues/597

The element type of array literals is incorrectly inferred from the type of the first non-null element.
The element type should be the most specific type that is assignable from every element. For example, given:

class Base is si
class Derived: Base is si

let o: Object;
let b: Base;
let d: Derived;
- the type of [b, b, d, d] should be Base[], 
- the type of [d, d, d, d] should be Derived[], 
- the type of [o, b, b, d] should be object[]
- the type of [1234, b, b, d] should be Object[]

*/

namespace Test is
    use Std = IO.Std;

    class Base is si
    class Derived: Base is si
    
    class Main is
        entry() static is
            let o: object;
            let b: Base;
            let d: Derived;

            let expect_base: Base[];
            let expect_derived: Derived[];
            let expect_object: object[];
            let expect_int: int[];

            // OK
            expect_base = [b, b, b, b];
            expect_base = [b, null, b, b];
            expect_base = [null, b, b, d];
            expect_base = [d, b, b, d];
            expect_base = [d, d, d, b];
            expect_base = [b, d, d, d];

            // should fail
            expect_int = [b, b, b, b];
            expect_int = [b, null, b, b];
            expect_int = [null, b, b, d];
            expect_int = [d, b, b, d];
            expect_int = [d, d, d, b];
            expect_int = [b, d, d, d];

            // OK
            expect_derived = [d, d, d, d];
            expect_derived = [null, d, d, d];
            expect_derived = [null, null, null, d];

            // should fail
            expect_int = [d, d, d, d];
            expect_int = [null, d, d, d];
            expect_int = [null, null, null, d];
            
            // OK
            expect_object = [o, b, b, d];
            expect_object = [d, o, b, b];
            expect_object = [null, o, b, d];
            expect_object = [1234, b, b, d];

            // should fail
            expect_int = [o, b, b, d];
            expect_int = [d, o, b, b];
            expect_int = [null, o, b, d];
            expect_int = [1234, b, b, d];

            // OK
            expect_int = [1, 2, 3, 4];

            // OK:
            expect_object = [null, null];

            // should fail
            expect_int = [null, null];
        si
    si
si