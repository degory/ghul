namespace Shim is
    use Collections.Iterable;
    use Collections.Iterator;

    class ONLY[T] is
        iterable: Iterable[T];
        predicate: (T) -> bool;

        result: T is
            let i = iterable.iterator;
            while i.move_next() do
                let e = i.current;

                if !predicate? || predicate(e) then
                    assert !i.move_next() else "ONLY: more than one element";

                    return e;
                fi                                
            od
        si
        
        init(iterable: Iterable[T], predicate: (T) -> bool) is
            self.iterable = iterable;
            self.predicate = predicate;
        si

        init(iterable: Iterable[T]) is
            self.iterable = iterable;
        si
    si
si
