namespace Shim is
    use Collections.Iterable;
    use Collections.Iterator;

    class MAPPER[F,T]: System.Object,Iterable[T] is
        iterable: Iterable[F];
        mapper: (F) -> T;

        iterator: Iterator[T] => new MAPPER_ITERATOR[F,T](iterable.iterator, mapper);
        
        init(iterable: Iterable[F], mapper: (F) -> T) is
            self.iterable = iterable;
            self.mapper = mapper;
        si
    si

    class MAPPER_ITERATOR[F,T]: System.Object,Iterator[T] is
        _iterator: Iterator[F];
        _mapper: (F) -> T;

        @IL.name.read("get_Current")
        current: T => _mapper(_iterator.current);

        init(iterator: Iterator[F], mapper: (F) -> T) is
            _iterator = iterator;
            _mapper = mapper;
        si
        
        @IL.name("MoveNext")
        move_next() -> bool => _iterator.move_next();

        @IF.legacy()
        hasMoreElements() -> bool => _iterator.hasMoreElements();

        @IF.legacy()
        nextElement() -> T => _mapper(_iterator.nextElement());
    si
si
