namespace IR is
    use Generic;
    use System;

    class FILE is
        path: String;
        writer: IO.Writer;

        init(
            path: String,
            writer: IO.Writer
        ) is
            super.init();

            self.path = path;
            self.writer = writer;
        si
    
        init(
            path: String
        ) is 
            init(path, IO.File.openCreate(path));
        si
    si

    class CONTEXT is
        files: Vector[FILE];

        init() is
            files = new Vector[FILE]();
            files.add(new FILE("(stderr)", IO.Std.err));
        si

        println(value: Object) is
            current_file.writer.println("        " + value);
        si

        println(value: Object, comment: Object) is
            current_file.writer.println("        " + value + "        // " + comment);
        si

        current_file: FILE => files.Top;

        enter_file(path: String) is
            files.add(new FILE(path));
        si

        leave_file(path: String) is
            while files.Length > 0 do                
                if current_file.path =~ path then
                    current_file.writer.close();
                    files.pop();
                    return;
                else
                    IO.Std.err.println("oops - IL output context stack corrupt");
                fi

                files.pop();
            od
            IO.Std.err.println("oops - IL output context stack corrupt");
        si        
    si
si
