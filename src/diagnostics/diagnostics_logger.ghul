namespace Diagnostics is
    use System.Exception;

    use Logging.Logger;
    use Logging.LoggerState;

    class DIAGNOSTICS_LOGGER: Logger is
        _store: DIAGNOSTIC_STORE;

        init() is
            _store = new DIAGNOSTIC_STORE();
        si        

        is_poisoned: bool => _store.is_poisoned;
        has_errors: bool => _store.has_errors;

        write_to(writer: DiagnosticWriter) is
            _store.write_to(writer);
        si

        write_poison_messages() is            
        si

        clear() => _store.clear();
        reset() => _store.reset();

        push() is
            _store.push();
        si
        
        pop() -> LoggerState is
            return _store.pop();
        si
        
        merge_down() is
            _store.merge_down();
        si
                
        merge(state: LoggerState) is
            _store.merge(cast DIAGNOSTIC_STATE(state));
        si
        
        exception(location: Source.LOCATION, exception: Exception, message: string) is
            // IO.Std.error.write_line("!!! !!! DIAG EXCEPT: " + exception + " " + message);

            _store.add(
                location.file_name,
                new DIAGNOSTIC(
                    SEVERITY.fatal,
                    location,
                    message
                )
            );

            _store.poison();
        si
        
        fatal(location: Source.LOCATION, message: string) is
            // IO.Std.error.write_line("!!! !!! DIAG FATAL: " + message);

            _store.add(
                location.file_name, 
                new DIAGNOSTIC(
                    SEVERITY.fatal,
                    location,
                    message)
                );
        si
        
        error(location: Source.LOCATION, message: string) is
            _store.add(
                location.file_name, 
                new DIAGNOSTIC(
                    SEVERITY.error,
                    location,
                    message)
                );            
        si
        
        warn(location: Source.LOCATION, message: string) is
            _store.add(
                location.file_name, 
                new DIAGNOSTIC(
                    SEVERITY.warn,
                    location,
                    message)
                );
        si
        
        info(location: Source.LOCATION, message: string) is
            _store.add(
                location.file_name,
                new DIAGNOSTIC(
                    SEVERITY.info,
                    location,
                    message)
                );
        si
        
        hint(location: Source.LOCATION, message: string) is
            _store.add(
                location.file_name,
                new DIAGNOSTIC(
                    SEVERITY.hint,
                    location,
                    message)
                );
        si

        poison(location: Source.LOCATION, message: string) is
            _store.add(
                location.file_name,
                new DIAGNOSTIC(
                    SEVERITY.poison,
                    location,
                    message)
                );

            _store.poison();
        si
    si
si
