{
    "version": "2.0.0",
    "options": {
        "env": {
            "PACKAGE_VERSION": "${config:version}",
            "TAG_VERSION": "v${config:version}"
        },    
    },
    "tasks": [
        {
            "label": "Set version number",
            "command": "dotnet",
            "type": "shell",
            "args": [
                "setversion",                
                "${config:version}",
                "ghul.ghulproj"
            ],
            "group": "build",
            "presentation": {
                "reveal": "always"
            },
            "problemMatcher": []
        },
        {
            "label": "Build",
            "command": "dotnet",
            "type": "shell",
            "args": [
                "build",
                "/property:GenerateFullPaths=true",
                "/consoleloggerparameters:NoSummary"
            ],
            "group": "build",
            "dependsOn": "Set version number",
            "presentation": {
                "reveal": "silent"
            },
            "problemMatcher": [
                "$ghūl",
                "$msCompile"
            ]
        },
        {
            "label": "Build using published compiler",
            "command": "dotnet",
            "type": "shell",
            "args": [
                "build",
                "/property:GhulCompiler=./bin/Debug/net6.0/publish/ghul",
                "/property:GenerateFullPaths=true",
                "/consoleloggerparameters:NoSummary"
            ],
            "group": "build",
            "presentation": {
                "reveal": "silent"
            },
            "problemMatcher": [
                "$ghūl",
                "$msCompile"
            ]
        },
        {
            "label": "Install latest public version",
            "command": "dotnet",
            "type": "shell",
            "args": [
                "tool",
                "update",
                "--global",
                "ghul.compiler"
            ],
            "dependsOn": [
                "Uninstall"
            ],
            "group": "build",
            "presentation": {
                "reveal": "always",
                "panel": "shared"
            },
            "problemMatcher": []
        },
        {
            "label": "Install development version",
            "command": "dotnet",
            "type": "shell",
            "args": [
                "tool",
                "update",
                "-g",
                "ghul.compiler",
                "--add-source",
                "./nupkg/",
                "--version",
                "${config:version}"
            ],
            "dependsOn": [
                "Pack"
            ],
            "group": "build",
            "presentation": {
                "reveal": "silent"
            },
            "problemMatcher": []
        },
        {
            "label": "Uninstall",
            "type": "shell",
            "command": "dotnet",
            "args": [
                "tool",
                "uninstall",
                "--global",
                "ghul.compiler"
            ],
            "group": "build",
            "presentation": {
                "reveal": "silent"
            },
            "problemMatcher": []
        },
        {
            "label": "Clean",
            "type": "shell",
            "command": "dotnet",
            "args": [
                "clean"
            ],
            "group": "build",
            "presentation": {
                "reveal": "silent"
            },
            "problemMatcher": []
        },
        {
            "label": "Pack",
            "type": "shell",
            "command": "dotnet",
            "args": [
                "pack",
                "/property:Version=${config:version}",
                "/property:ReleaseOption=\"--define release\"",
                "/property:GenerateFullPaths=true",
                "/consoleloggerparameters:NoSummary"
            ],
            "dependsOn": [
                "Clean"
            ],
            "group": "build",
            "presentation": {
                "reveal": "silent"
            },
            "problemMatcher": [
                "$ghūl",
                "$msCompile"
            ]
        },
        {
            "label": "Publish",
            "type": "shell",
            "command": "dotnet",
            "args": [
                "publish",
                "/property:Version=${config:version}",
                "/property:ReleaseOption=\"--define release\"",
                "/property:GenerateFullPaths=true",
                "/consoleloggerparameters:NoSummary"
            ],
            "dependsOn": [
                "Build"
            ],
            "group": "build",
            "presentation": {
                "reveal": "silent"
            },
            "problemMatcher": [
                "$ghūl",
                "$msCompile"
            ]
        },
        {
            "label": "Generate .assemblies.json",
            "type": "shell",
            "command": "dotnet",
            "args": [
                "build",
                "/target:GenerateAssembliesJson",
                "/consoleloggerparameters:NoSummary"
            ],
            "group": "build",
            "presentation": {
                "reveal": "silent"
            },
            "problemMatcher": [
                "$msCompile"
            ]
        },
        {
            "label": "Bootstrap",
            "type": "shell",
            "command": "./build/bootstrap.sh",
            "group": "build",
            "problemMatcher": "$ghūl"
        },
        {
            "label": "Build development container",
            "type": "shell",
            "command": "docker build --no-cache . -f devcontainer-dotnet.dockerfile -t ghul/devcontainer:${config:version}",
            "group": "build",
            "dependsOn": [
                "Pack"
            ],
            "problemMatcher": []
        },
        {
            "label": "Run all integration tests",
            "type": "shell",
            "command": "dotnet ghul-test integration-tests",
            "group": "test",
            "dependsOn": [
                "Install development version"
            ]
        },
        {
            "label": "Run failed integration tests",
            "type": "shell",
            "command": "./integration-tests/run-failed.sh",
            "group": "test",
            "dependsOn": [
                "Install development version"
            ]
        },
        {
            "label": "Create new test",
            "type": "shell",
            "command": "./integration-tests/create.sh",
            "group": "test",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": true,
                "panel": "shared",
                "showReuseMessage": true,
                "clear": false
            }
        },
        {
            "label": "Edit all failed tests",
            "type": "shell",
            "command": "./integration-tests/edit-failed.sh",
            "group": "test",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": true,
                "panel": "shared",
                "showReuseMessage": true,
                "clear": false
            }
        }
    ]
}