namespace Syntax is
    namespace Process is
        use Generic;
        use Source;
        use Tree;
        class MAP : SortedMap[NODE, NODE]  is
            _delete: NODE;
            init() is
                super.init();
                
                if _delete == null then
                    _delete = new NODE(LOCATION.dummy);
                fi
            si

            [n: NODE]: NODE public
                is
                    if n == null then
                        return null;
                    fi
                    var result = super[n];
                    if result == _delete then
                        return null;
                    elif result == null then
                        return n;
                    else
                        return result;
                    fi
                si,
                = m is
                    var prev = super[n];
                    if prev!=null && prev!=n then
                        if prev == _delete then
                            IO.Std.err.println("replacing previously deleted value at " + n + " with " + m);
                        else
                            IO.Std.err.println(
                            "replacing previously updated value " + prev + " at " + n + " with " + m);
                        fi
                    fi
                    super[n] = m;
                si

            delete(n: NODE) is
                self[n] = _delete;
            si
        si
    si
si
